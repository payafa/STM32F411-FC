/*
 * MPU9250.h
 *
 * MPU9250????????????
 * ????STM32F411CEU6??MPU9250?????
 *
 * ??????????????
 */

#ifndef MPU9250_H
#define MPU9250_H

#include "I2C.h"

/* ???? */
#define MPU9250_ADDR             0xD2        // MPU9250 I2C???
#define MPU9250_WHO_AM_I_REG     0x75        // WHO_AM_I????????
#define MPU9250_WHO_AM_I_VAL     0x71        // WHO_AM_I?

/* ???????????? */
#define MPU9250_SMPLRT_DIV_REG    0x19        // ??????????
#define MPU9250_CONFIG_REG        0x1A        // ????
#define MPU9250_GYRO_CONFIG_REG   0x1B        // ??????????
#define MPU9250_ACCEL_CONFIG_REG  0x1C        // ??????????
#define MPU9250_ACCEL_XOUT_H_REG  0x3B        // ??????X??????
#define MPU9250_ACCEL_XOUT_L_REG  0x3C        // ??????X??????
#define MPU9250_ACCEL_YOUT_H_REG  0x3D        // ??????Y??????
#define MPU9250_ACCEL_YOUT_L_REG  0x3E        // ??????Y??????
#define MPU9250_ACCEL_ZOUT_H_REG  0x3F        // ??????Z??????
#define MPU9250_ACCEL_ZOUT_L_REG  0x40        // ??????Z??????
#define MPU9250_TEMP_OUT_H_REG    0x41        // ???????
#define MPU9250_TEMP_OUT_L_REG    0x42        // ???????
#define MPU9250_GYRO_XOUT_H_REG   0x43        // ??????X??????
#define MPU9250_GYRO_XOUT_L_REG   0x44        // ??????X??????
#define MPU9250_GYRO_YOUT_H_REG   0x45        // ??????Y??????
#define MPU9250_GYRO_YOUT_L_REG   0x46        // ??????Y??????
#define MPU9250_GYRO_ZOUT_H_REG   0x47        // ??????Z??????
#define MPU9250_GYRO_ZOUT_L_REG   0x48        // ??????Z??????
#define MPU9250_PWR_MGMT_1_REG    0x6B        // ???????1
#define MPU9250_PWR_MGMT_2_REG    0x6C        // ???????2

/* ????????? */
typedef struct {
    int16_t accelX;  // ??????X?????
    int16_t accelY;  // ??????Y?????
    int16_t accelZ;  // ??????Z?????
    int16_t gyroX;   // ??????X?????
    int16_t gyroY;   // ??????Y?????
    int16_t gyroZ;   // ??????Z?????
    int16_t temp;    // ??????
} MPU9250_RawData_t;

typedef struct {
    float accelX;  // ??????X??? (g)
    float accelY;  // ??????Y??? (g)
    float accelZ;  // ??????Z??? (g)
    float gyroX;   // ??????X??? (deg/s)
    float gyroY;   // ??????Y??? (deg/s)
    float gyroZ;   // ??????Z??? (deg/s)
    float temp;    // ???? (??C)
} MPU9250_Data_t;

typedef struct {
    float accelBiasX;  // ??????X?????
    float accelBiasY;  // ??????Y?????
    float accelBiasZ;  // ??????Z?????
    float gyroBiasX;   // ??????X?????
    float gyroBiasY;   // ??????Y?????
    float gyroBiasZ;   // ??????Z?????
} MPU9250_CalibData_t;

/* ???????? */
uint8_t MPU9250_Init(void);
uint8_t MPU9250_Check(void);
void MPU9250_ReadRawData(MPU9250_RawData_t *data);
void MPU9250_ReadData(MPU9250_Data_t *data);
void MPU9250_Calibrate(MPU9250_CalibData_t *calibData);

#endif /* MPU9250_H */
